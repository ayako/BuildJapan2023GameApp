<!DOCTYPE html>
<html>
<head>
    <title>シューティングゲーム</title>
    <style>
        canvas {
            border: 1px solid black;
            background-color: black;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <script>
        // キーコード
        const KEY_LEFT = 37;
        const KEY_UP = 38;
        const KEY_RIGHT = 39;
        const KEY_DOWN = 40;
        const KEY_SPACE = 32;

        // ゲームオブジェクト
        let spaceship;
        let asteroids = [];
        let bullets = [];

        // キーの状態
        let keyState = {};

        // キーが押されたときの処理
        window.addEventListener('keydown', function(e) {
            keyState[e.keyCode] = true;
        });

        // キーが離されたときの処理
        window.addEventListener('keyup', function(e) {
            keyState[e.keyCode] = false;
        });

        // 宇宙船のクラス
        class Spaceship {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 20;
                this.height = 20;
                this.color = 'red';
            }

            update() {
                // キーの状態に応じて移動
                if (keyState[KEY_LEFT]) {
                    this.x -= 5;
                }
                if (keyState[KEY_UP]) {
                    this.y -= 5;
                }
                if (keyState[KEY_RIGHT]) {
                    this.x += 5;
                }
                if (keyState[KEY_DOWN]) {
                    this.y += 5;
                }

                // 画面外に出ないようにする
                if (this.x < 0) {
                    this.x = 0;
                }
                if (this.x > canvas.width - this.width) {
                    this.x = canvas.width - this.width;
                }
                if (this.y < 0) {
                    this.y = 0;
                }
                if (this.y > canvas.height - this.height) {
                    this.y = canvas.height - this.height;
                }

                // 弾を発射
                if (keyState[KEY_SPACE]) {
                    bullets.push(new Bullet(this.x + this.width / 2, this.y));
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        // 小惑星のクラス
        class Asteroid {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 20;
                this.height = 20;
                this.color = 'gray';
            }

            update() {
                // 移動
                this.y += 3;

                // 画面外に出たら削除
                if (this.y > canvas.height) {
                    asteroids.splice(asteroids.indexOf(this), 1);
                }

                // 衝突判定
                for (let i = 0; i < bullets.length; i++) {
                    if (this.x < bullets[i].x + bullets[i].width &&
                        this.x + this.width > bullets[i].x &&
                        this.y < bullets[i].y + bullets[i].height &&
                        this.y + this.height > bullets[i].y) {
                        asteroids.splice(asteroids.indexOf(this), 1);
                        bullets.splice(i, 1);
                    }
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        // 弾のクラス
        class Bullet {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 5;
                this.height = 10;
                this.color = 'yellow';
            }

            update() {
                // 移動
                this.y -= 5;

                // 画面外に出たら削除
                if (this.y < 0) {
                    bullets.splice(bullets.indexOf(this), 1);
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        // ゲームの初期化
        function init() {
            spaceship = new Spaceship(canvas.width / 2 - 10, canvas.height - 40);
            setInterval(spawnAsteroid, 1000);
            setInterval(update, 30);
            setInterval(draw, 30);
        }

        // 小惑星の生成
        function spawnAsteroid() {
            let x = Math.random() * (canvas.width - 20);
            let y = -20;
            asteroids.push(new Asteroid(x, y));
        }

        // ゲームの更新
        function update() {
            spaceship.update();
            for (let i = 0; i < asteroids.length; i++) {
                asteroids[i].update();
            }
            for (let i = 0; i < bullets.length; i++) {
                bullets[i].update();
            }
        }

        // ゲームの描画
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            spaceship.draw();
            for (let i = 0; i < asteroids.length; i++) {
                asteroids[i].draw();
            }
            for (let i = 0; i < bullets.length; i++) {
                bullets[i].draw();
            }
        }

        // キャンバスの取得
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');

        // ゲームの初期化
        init();

    </script>
</body>
</html>